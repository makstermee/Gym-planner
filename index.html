<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trening Pro </title>
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div id="appLoader" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #111; z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white;">
    <div class="spinner" style="width: 50px; height: 50px; border: 5px solid #333; border-top: 5px solid #ff5722; border-radius: 50%; animation: spin 1s linear infinite;"></div>
    <p style="margin-top: 20px; font-family: sans-serif;">Wczytywanie planu...</p>
</div>
<style>
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
</style>

<script type="module">
  // Importy - u偶ywamy tych samych wersji, co w app.js (11.6.1)
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getAuth } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
  import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
  // Analytics nie jest u偶ywane w app.js, wic pomijam import getAnalytics dla czystoci

  // Konfiguracja (bez zmian)
  const firebaseConfig = {
    apiKey: "AIzaSyCacBxUhSiqaaCBrmVVKluMHMs3iMpR_cA",
    authDomain: "pro-plan-e6f00.firebaseapp.com",
    databaseURL: "https://pro-plan-e6f00-default-rtdb.europe-west1.firebasedabase.app",
    projectId: "pro-plan-e6f00",
    storageBucket: "pro-plan-e6f00.firebasestorage.app",
    messagingSenderId: "887703996706",
    appId: "1:887703996706:web:b7363c891b41b7d4697d7b",
    measurementId: "G-1WTB0NNLEB"
  };

  // Inicjalizacja i przekazanie zmiennych do okna (window)
  try {
    const app = initializeApp(firebaseConfig);

    // TO JEST KLUCZOWY BRAKUJCY ELEMENT:
    // Udostpnij globalne zmienne, kt贸rych oczekuje app.js
    window.auth = getAuth(app);
    window.db = getFirestore(app);
    window.appId = firebaseConfig.appId;
    window.IS_FIREBASE_CONFIGURED = true;
    
    console.log("Firebase skonfigurowane i gotowe (index.html).");

  } catch (error) {
    console.error("Bd inicjalizacji Firebase:", error);
    window.IS_FIREBASE_CONFIGURED = false;
  }
</script>


<header class="top">
  <h1>Trening Pro<span id="welcomeMsg"></span></h1>
  <div id="masterTimerDisplay" class="master-timer" style="display:none;">00:00:00</div>
</header>

<main class="container">

  <section id="panel-auth" class="panel active">
    <h2>Zarzdzanie Kontem </h2>
    <div id="authStatusArea" style="text-align: center; margin-bottom: 20px;">
        <p id="currentAuthStatus" style="font-weight: bold; color: var(--text);"></p>
        <p id="authError" style="color: var(--danger); font-weight: bold;"></p>
    </div>

    <div id="configWarning" style="background: var(--danger); color: #fff; padding: 15px; border-radius: 10px; margin-bottom: 20px; display: none;">
        <strong>Bd Konfiguracji Chmury!</strong><br>
        <p style="margin: 5px 0 0 0;">Autoryzacja i zapis na wielu urzdzeniach nie s dostpne, dop贸ki system nie dostarczy konfiguracji Firebase.</p>
    </div>

       <div id="authForm">
        <p style="text-align: center; color: var(--muted); margin-top: 0;">Zaloguj si lub zarejestruj, aby zapisywa postpy.</p>
        <input id="authEmail" type="email" placeholder="E-mail" required />
        <input id="authPassword" type="password" placeholder="Haso (min. 6 znak贸w)" required />
        
        <div class="button-row" style="margin-top: 20px;">
          <button id="loginBtn" class="btn-success">Zaloguj</button>
          <button id="registerBtn" class="btn-secondary">Zarejestruj</button>
        </div>
    </div>
    
    <button id="logoutBtn" class="btn-danger" style="display: none; width: 100%; margin-top: 20px;">Wyloguj si</button>
 
    
    <hr style="margin-top: 30px; border-color: var(--muted-light);">
    <p style="font-size: 0.8em; text-align: center; color: var(--muted);">
        ID U偶ytkownika (wymagany do zapis贸w): <span id="currentUserIdDisplay" style="font-weight: bold; color: var(--accent);">Brak ID</span>
    </p>
  </section>

  <section id="panel-main" class="panel">
    <h2>Plany Treningowe </h2>
    <div id="dayList" class="day-list">
      </div>
  </section>
  
  <section id="panel-plan-details" class="panel">
    <h2 id="planDetailsTitle">Plan: Poniedziaek</h2>
    <div id="planDetailsList" class="exercise-list">
      </div>
    <div class="button-row" style="margin-top: 20px;">
      <button id="editPlanBtn" class="btn-secondary">Edytuj plan</button>
      <button id="startWorkoutBtn" class="btn-success">Rozpocznij trening</button>
    </div>
    <button id="backToMainBtn" class="btn-secondary" style="margin-top: 10px; width: 100%;">Powr贸t do listy dni</button>
  </section>

  <section id="panel-edit-plan" class="panel">
    <h2 id="editPlanTitle">Edytuj: Dzie</h2>
    
    <h3>Dodaj wiczenie</h3>
    <div class="input-row">
      <input id="exName" placeholder="Nazwa wiczenia (np. Przysiady)" required />
      <input id="exTargetSets" type="number" min="1" value="3" placeholder="Serie" required style="flex: 0 0 80px;" />
      <input id="exTargetReps" type="number" min="1" value="10" placeholder="Powt." required style="flex: 0 0 80px;" />
      <button id="addExerciseBtn" style="flex: 0 0 80px;">Dodaj</button>
    </div>
    
    <h3>wiczenia w Planie</h3>
    <div id="editPlanList" class="exercise-list">
      </div>

    <div class="button-row" style="margin-top: 20px;">
      <button id="savePlanChangesBtn" class="btn-success">Zapisz zmiany i wr贸</button>
    </div>
  </section>

  <section id="panel-active-workout" class="panel">
    <h2 id="activeWorkoutTitle">Aktywny Trening</h2>
    <div id="activeWorkoutList" class="exercise-list">
      </div>
    
    <button id="finishWorkoutBtn" class="btn-danger" style="margin-top: 20px; width: 100%;">Zakocz Trening i Zapisz Log</button>
  </section>

  <section id="panel-settings" class="panel">
    <h2>Ustawienia 锔</h2>
    
    <label for="loggedUserEmailDisplay" style="font-size: 0.9em; margin-bottom: 5px;">Status konta:</label>
    <p id="loggedUserEmailDisplay" style="font-weight: bold; margin-bottom: 20px; color: var(--accent);"></p>

    <p style="color: var(--muted); text-align: center;">Aplikacja dziaa w trybie ciemnym.</p>
  </section>

  <section id="panel-logs" class="panel">
    <h2>Historia Log贸w </h2>
    <div id="logArea" class="log-area">
      </div>
    
    <div class="button-row" style="margin-top: 20px;">
      <button id="clearHistory" class="btn-danger">Wyczy histori</button>
      <button id="exportBtn">Eksportuj JSON</button>
      <button id="importBtn" class="btn-secondary">Importuj JSON</button>
      <input type="file" id="fileInput" style="display:none" accept=".json">
    </div>
  </section>

  <section id="panel-stats" class="panel">
    <h2>Statystyki </h2>
    <canvas id="statsChart" height="250"></canvas>
    <p style="text-align: center; color: var(--muted); margin-top: 10px;">Objto treningowa (kg * powt贸rzenia) w czasie.</p>
  </section>


  </section>

</main>

<nav class="bottom-nav" id="bottomNav" style="display: none;">
  <button data-panel="panel-main">Plan</button>
  <button data-panel="panel-logs">Logi</button>
  <button data-panel="panel-stats">Statystyki</button>
  <button data-panel="panel-settings">Ustawienia</button>
  <button data-panel="panel-auth">Konto</button>
</nav>

<script type="module" src="app-v2.js"></script>
</body>
</html>
